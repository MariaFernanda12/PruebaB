<!DOCTYPE html>
<html>
    <head>
        <title>Library Soft</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <link href="../CSS/layout.css" rel="stylesheet" type="text/css" media="all">
        <script type="text/javascript" src="../scripts/jquery.min.js"></script>
        <script type="text/javascript" src="../scripts/scriptHome.js"></script>
        <link href="../CSS/mystyle.css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../Images/icono.png">   
        <script>
            var etiqueta;
            $(document).ready(function () {
                $(".modal").hide();


            });

            function mostrar() {
                $(".modal").show();
            }
            window.setTimeout("document.getElementById('contenedor_carga').style.display='none';", 1500);
            $(document).ready(function () {
                obtenerData();
            });
            function obtenerData() {
                var indic = 1;
                $.ajax({
                    type: 'GET'
                    , url: "../BuscarElementoPorNombre"
                    , async: true
                    , cache: false
                    , success: function (resp) {
                        $.each(resp, function (indice, Elemento) {
                            $("#tabla").append($("<tr id='" + indic + "' onclick='pp(this);'> ").append(("<td>" + Elemento.etiqueta + "</td>" + "<td>" + Elemento.nombre + "</td>" + "<td>" + Elemento.cantidadDisponible + "</td>" + "<td>" + Elemento.ubicacion + "</td>" + "<td>" + Elemento.propiedad + "</td>" + "<td>" + Elemento.responsable + "</td>" + "<td>" + Elemento.area + "</td>" + "<td>" + Elemento.colegio + "</td>")))
                            indic++;
                        });
                    }
                });
            }

            function pp(x) {
                var y = x.rowIndex;
                var parametros = {
                    "identificador": y
                };
                $.ajax({
                    data: parametros,
                    url: "../Reservas",
                    type: "POST"

                }).done(function (response) {
                    console.log(response);
                    var cantidad = response.cantidadDisponible;
                    window.location.href = "#about";
                    document.getElementById('element').innerHTML = response.etiqueta;
                    etiqueta = response.etiqueta;
                    document.getElementById('nombreLibro').innerHTML = response.nombre;
                    document.getElementById('cantidad').innerHTML = response.cantidadDisponible;
                    var input = document.getElementById("campo1");
                    input.setAttribute("max", cantidad);
                    mostrar();
                    getUser2();


                });


            }
            function Buscar() {

                var tableReg = document.getElementById('tabla');
                var searchText = document.getElementById('Busqueda').value.toLowerCase();
                var cellsOfRow = "";
                var found = false;
                var compareWith = "";

                for (var i = 1; i < tableReg.rows.length; i++)
                {
                    cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
                    found = false;
                    // Recorremos todas las celdas
                    for (var j = 0; j < cellsOfRow.length && !found; j++)
                    {
                        compareWith = cellsOfRow[j].innerHTML.toLowerCase();
                        // Buscamos el texto en el contenido de la celda
                        if (searchText.length == 0 || (compareWith.indexOf(searchText) > -1))
                        {
                            found = true;
                        }
                    }
                    if (found)
                    {
                        tableReg.rows[i].style.display = '';
                    } else {
                        tableReg.rows[i].style.display = 'none';
                    }
                }
            }
            function getUser2() {
                $.ajax({
                    url: "../Sesion",
                    type: "GET"

                }).done(function (response) {
                    console.log(response);
                    if (response == "false") {
                        window.location.href = "index.html";
                    } else {
                        document.getElementById('ident2').innerHTML = response.identificador;
                        document.getElementById('nombre2').innerHTML = response.nombreSol;
                        document.getElementById('curso2').innerHTML = response.cursoArea;
                    }
                });
            }

            function Reserva(fechaRes, cantidad) {

                $.ajax({
                    url: "../Sesion",
                    type: "GET"

                }).done(function (response) {
                    console.log(response);
                    if (response == "false") {
                        window.location.href = "index.html";
                    } else {
                        idSol = response.identificador;
                        curso = response.cursoArea;
                    }
                });
                var parametros = {
                    "idElm": etiqueta,
                    "fechaRes": fechaRes,
                    "cantidad": cantidad
                };
                $.ajax({
                    data: parametros,
                    url: "../Reservas",
                    type: "GET"

                }).done(function (response) {
                    console.log(response);
                    if (response != false) {
                        alert("No se pudo realizar la reserva");
                    } else {
                        alert("Reserva realizada satisfactoriamente");
                        window.location.href = "historial.html";
                    }



                });

            }
        </script>
    </head>
    <body id="top">
        <div id="contenedor_carga">
            <img src="../Images/titulo1.png" alt="Not-Found">
            <div id="carga"></div>
            <div class="tag">
                <p>Cargando...</p>
            </div>
        </div>
        <div class="wrapper row0">
            <div class="page-container">
                <div id="topbar" class="hoc clear">
                    <ul>
                        <li><p>Usuario:</p></li>
                        <li><p id="ident"></p></li>
                        <li><p id="nombre"></p></li>
                        <li><p id="col"></p></li>
                        <li><p id="curso"></p></li>
                        <li><a onclick="closeSesion();" title="Cerrar Sesión"><i class="fa fa-lg fa-power-off"></i></a></li>
                        <li><a href="perfil.jsp"  title="Mi Perfil"><img alt="NotFound" id="imageUser" /></a></li>

                    </ul>
                </div>
            </div>
        </div>
        <div class="wrapper row1">
            <header id="header" class="hoc clear">
                <div id="logo" class="fl_center">
                    <a href="homeUser.html"><img id="imagenPrincipal" src="../Images/titulo1.png" alt=""></a>
                </div>

            </header>
        </div>
        <div id="a" class="bgded" style="background-image:url('../Images/background4.jpg');">
            <div class="wrapper row2">
                <nav id="mainav" class="hoc clear"> 
                    <ul class="clear">
                        <li><a href="homeAdmin.jsp">Home</a></li>                       
                        <li><a href="Listados.html">Inventario Disponible</a></li>
                        <li><a href="IngresarInv.html">Ingresar Libro</a></li>
                        <li><a href="Prestamos.html">Prestamos</a></li>
                        <li class="active"><a href="Devoluciones.html">Devoluciones</a></li>
                        <li><a href="reservas.jsp">Reservas Pendientes</a></li>
                        <li><a href="historial.html">Historial</a></li>
                        <li><a href="Busquedas.html">Busquedas</a></li>
                        <li><a href="Estadisticas.html">Estadísticas</a></li>
                        <li><a href="#">Convenios</a></li>
                        <li><a href="#">Cargar base de datos</a></li>
                    </ul>
                </nav>
            </div>
            <div class="wrapper overlay">
                <div id="breadcrumb" class="hoc clear"> 
                    <img src="../Images/tituloDev.png" alt="NF">
                </div>
            </div>

            <div class="wrapper row3">
                
            </div>
        </div>

        <div class="wrapper row5">
            <div id="copyright" class="hoc clear">
                <p>LibrarySoft &copy; 2017 - Todos los derechos reservados - <a href="#">www.librarysoft.com.co</a></p>
            </div>
        </div>
        <a id="backtotop" href="#top"><i class="fa fa-chevron-up"></i></a>
        <!-- JAVASCRIPTS -->
        <script language="JavaScript" type="text/javascript" src="../scripts/jquery.min.js"></script>
        <script language="JavaScript" type="text/javascript" src="../scripts/jquery.backtotop.js"></script>
        <script language="JavaScript" type="text/javascript" src="../scripts/jquery.mobilemenu.js"></script> 
    </body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                